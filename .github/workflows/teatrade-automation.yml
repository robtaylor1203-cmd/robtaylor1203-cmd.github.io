name: TeaTrade Live Data Update

on:
  schedule:
    - cron: '0 6 * * *'  # Daily at 6 AM UTC
  workflow_dispatch:

jobs:
  update-live-data:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ›’ Checkout your beautiful website
        uses: actions/checkout@v4
        
      - name: ğŸ Setup Python for automation
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          
      - name: ğŸ“¦ Install automation dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r automation_requirements.txt
          
      - name: ğŸš€ Run data collection
        run: |
          python run_automation.py
          
      - name: ğŸ“Š Update website with live data
        run: |
          # Add timestamp to your beautiful design
          if [ -f "index.html" ]; then
            # Add last updated timestamp
            sed -i 's/<!-- Last automated update:.*/<!-- Last automated update: '"$(date -u '+%Y-%m-%d %H:%M:%S UTC')"' -->/' index.html
            if ! grep -q "Last automated update" index.html; then
              sed -i '/<\/body>/i\    <!-- Last automated update: '"$(date -u '+%Y-%m-%d %H:%M:%S UTC')"' -->' index.html
            fi
          fi
          
      - name: ğŸ’¾ Commit live data updates
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "TeaTrade Automation"
          
          git add data/latest/
          if [ -f "index.html" ]; then
            git add index.html
          fi
          
          if ! git diff --staged --quiet; then
            git commit -m "ğŸ¤– Live data update $(date -u '+%Y-%m-%d %H:%M UTC')

âœ¨ Your beautiful TeaTrade design enhanced with fresh market data
ğŸ“Š Data collection: Successful
ğŸ• Next update: $(date -u -d '+1 day' '+%Y-%m-%d 06:00 UTC')"

            git push
            echo "âœ… Live data updated successfully!"
          else
            echo "ğŸ“ No data changes to commit"
          fi
